---
---

<form id="contact-form" class="contact-form" novalidate>
  <div class="form-row">
    <div class="form-group">
      <label for="prenom">Prénom</label>
      <input type="text" id="prenom" name="prenom" autocomplete="given-name" />
    </div>
    <div class="form-group">
      <label for="nom">Nom de famille</label>
      <input type="text" id="nom" name="nom" autocomplete="family-name" />
    </div>
  </div>

  <div class="form-group">
    <label for="organisation">Nom de l'organisation <span class="required">*</span></label>
    <input type="text" id="organisation" name="organisation" required autocomplete="organization" />
  </div>

  <div class="form-row">
    <div class="form-group">
      <label for="telephone">Téléphone</label>
      <input type="tel" id="telephone" name="telephone" autocomplete="tel" />
    </div>
    <div class="form-group">
      <label for="email">Courriel <span class="required">*</span></label>
      <input type="email" id="email" name="email" required autocomplete="email" />
    </div>
  </div>

  <div class="form-group">
    <label for="message">Besoins ou questions</label>
    <textarea id="message" name="message" rows="4"></textarea>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label for="moment-date">Date souhaitée <span class="required">*</span></label>
      <input type="date" id="moment-date" name="moment-date" required />
    </div>
    <div class="form-group">
      <label for="moment-heure">Heure souhaitée <span class="required">*</span></label>
      <select id="moment-heure" name="moment-heure" required>
        <option value="" disabled selected>Choisir un créneau</option>
        <option value="08:00">08:00</option>
        <option value="08:30">08:30</option>
        <option value="09:00">09:00</option>
        <option value="09:30">09:30</option>
        <option value="10:00">10:00</option>
        <option value="10:30">10:30</option>
        <option value="11:00">11:00</option>
        <option value="11:30">11:30</option>
        <option value="12:00">12:00</option>
        <option value="12:30">12:30</option>
        <option value="13:00">13:00</option>
        <option value="13:30">13:30</option>
        <option value="14:00">14:00</option>
        <option value="14:30">14:30</option>
        <option value="15:00">15:00</option>
        <option value="15:30">15:30</option>
        <option value="16:00">16:00</option>
        <option value="16:30">16:30</option>
        <option value="17:00">17:00</option>
        <option value="17:30">17:30</option>
      </select>
      <span class="form-hint">Lun. au ven., heure de l'Est</span>
    </div>
  </div>

  <button type="submit" class="btn btn-primary form-submit">Envoyer le message</button>

  <div id="form-status" class="form-status" hidden></div>
</form>

<script>
  const form = document.getElementById('contact-form') as HTMLFormElement;
  const status = document.getElementById('form-status') as HTMLDivElement;
  const submitBtn = form.querySelector('.form-submit') as HTMLButtonElement;

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    status.hidden = true;

    const formData = new FormData(form);
    const data: Record<string, string> = {};
    formData.forEach((value, key) => {
      data[key] = value as string;
    });

    const momentDate = data['moment-date'];
    const momentHeure = data['moment-heure'];
    if (momentDate && momentHeure) {
      data.moment = `${momentDate}T${momentHeure}`;
    }
    delete data['moment-date'];
    delete data['moment-heure'];

    if (!data.organisation || !data.email || !data.moment) {
      status.hidden = false;
      status.className = 'form-status form-status-error';
      status.textContent = 'Veuillez remplir tous les champs obligatoires.';
      return;
    }

    submitBtn.disabled = true;
    submitBtn.textContent = 'Envoi en cours…';

    try {
      const res = await fetch('/api/contact', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data),
      });

      const result = await res.json();

      if (res.ok) {
        status.hidden = false;
        status.className = 'form-status form-status-success';
        status.textContent = 'Message envoyé avec succès. Notre équipe vous contactera sous peu.';
        form.reset();
      } else {
        status.hidden = false;
        status.className = 'form-status form-status-error';
        status.textContent = result.error || 'Une erreur est survenue.';
      }
    } catch {
      status.hidden = false;
      status.className = 'form-status form-status-error';
      status.textContent = 'Erreur de connexion. Veuillez réessayer.';
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = 'Envoyer le message';
    }
  });
</script>

<style>
  .contact-form {
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
  }

  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.25rem;
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: 0.375rem;
  }

  .form-group label {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--color-text);
  }

  .required {
    color: var(--color-accent);
  }

  .form-group select,
  .form-group input,
  .form-group textarea {
    padding: 0.75rem 1rem;
    border: 1.5px solid var(--color-border);
    border-radius: var(--radius);
    font-family: var(--font-body);
    font-size: 0.9375rem;
    color: var(--color-text);
    background-color: var(--color-surface);
    transition: border-color var(--transition-soft), box-shadow var(--transition-soft);
    outline: none;
  }

  .form-group select {
    appearance: none;
    -webkit-appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236B7F8B' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 1rem center;
    padding-right: 2.5rem;
    cursor: pointer;
  }

  .form-group select:focus,
  .form-group input:focus,
  .form-group textarea:focus {
    border-color: var(--color-accent);
    box-shadow: 0 0 0 3px rgba(95, 159, 224, 0.12);
  }

  .form-group textarea {
    resize: vertical;
    min-height: 6rem;
  }

  .form-hint {
    font-size: 0.8rem;
    color: var(--color-text-light);
    margin-top: 0.125rem;
  }

  .form-submit {
    align-self: flex-start;
    margin-top: 0.5rem;
  }

  .form-submit:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
  }

  .form-status {
    padding: 1rem 1.25rem;
    border-radius: var(--radius);
    font-size: 0.9375rem;
    line-height: 1.5;
  }

  .form-status-success {
    background-color: rgba(107, 127, 94, 0.1);
    color: var(--color-sage);
    border: 1px solid rgba(107, 127, 94, 0.25);
  }

  .form-status-error {
    background-color: rgba(95, 159, 224, 0.1);
    color: var(--color-accent-hover);
    border: 1px solid rgba(95, 159, 224, 0.25);
  }

  @media (max-width: 768px) {
    .form-row {
      grid-template-columns: 1fr;
    }
  }
</style>
